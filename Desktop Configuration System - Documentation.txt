Desktop Configuration System - Documentation
Last Updated: October 2025
Compatible: Windows 10 Pro, Windows 11 Pro

## Table of Contents

1. [Overview]
2. [How It Works]
3. [Prerequisites]
4. [Installation Steps]
5. [Configuration Parameters]
6. [Post-Installation]
8. [Registry Changes Documentation]
9. [Logs and Troubleshooting]
10. [Rollback/Uninstall Steps]

1. Overview
This automated desktop configuration system enforces corporate standards across Windows workstations. The system runs automatically at every user logon to maintain consistent settings, even if users attempt to modify them.
What It Configures

Desktop wallpaper and lock screen (enforced)
Company screensaver with timeout and password protection
Chrome as default web browser (HTTP/HTTPS protocols + .htm/.html/.pdf files)
Chrome homepage (company website)
Outlook as default email client (mailto: protocol)
Taskbar application pins (Chrome, Word, Excel, Teams, Planner)
Edge browser removal from taskbar

Key Features

✅ Enforces settings every logon - User changes are automatically reverted
✅ No admin rights required - Runs for standard users
✅ Fast execution - Completes in under 30 seconds
✅ Complete audit trail - All changes logged with CSV export
✅ Local image storage - No network dependencies


2. How It Works
Deployment Architecture
┌─────────────────────────────────────────────────────────┐
│ INSTALLATION PHASE (One-time, Administrator Required)  │
├─────────────────────────────────────────────────────────┤
│  1. Prepare deployment folder with images:             │
│     deployment-folder/                                  │
│     ├── Deploy.bat                                     │
│     ├── DesktopConfig.ps1                             │
│     ├── wallpaper.jpg      ← Add your images          │
│     ├── lockscreen.jpg     ← Add your images          │
│     └── screensaver.jpg    ← Add your images          │
│                                                         │
│  2. Run Deploy.bat as Administrator                    │
│     ↓                                                   │
│  3. Deploy.bat creates C:\Scripts\ and C:\Scripts\Images\ │
│     ↓                                                   │
│  4. Deploy.bat copies:                                 │
│     - DesktopConfig.ps1 → C:\Scripts\                 │
│     - wallpaper.jpg → C:\Scripts\Images\              │
│     - lockscreen.jpg → C:\Scripts\Images\             │
│     - screensaver.jpg → C:\Scripts\Images\            │
│     ↓                                                   │
│  5. Script disables UCPD (registry modification)       │
│     ↓                                                   │
│  6. Script creates scheduled task                      │
│     ↓                                                   │
│  7. ⚠️ RESTART COMPUTER (mandatory)                   │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│ ENFORCEMENT PHASE (Every User Logon - Automatic)       │
├─────────────────────────────────────────────────────────┤
│  1. User logs in (standard account)                    │
│     ↓                                                   │
│  2. Scheduled task triggers (hidden, highest privilege)│
│     ↓                                                   │
│  3. Script runs configuration (no idempotency check)   │
│     ↓                                                   │
│  4. All settings applied/enforced (15-30 seconds)      │
│     ✓ Wallpaper reset                                  │
│     ✓ Lock screen reset                                │
│     ✓ Screensaver enforced                             │
│     ✓ Chrome defaults enforced                         │
│     ✓ Chrome homepage set                              │
│     ✓ Outlook default email                            │
│     ✓ Taskbar pins restored                            │
│     ↓                                                   │
│  5. Explorer restarts (applies taskbar changes)        │
│     ↓                                                   │
│  6. Changes logged to CSV and text log                 │
│     ↓                                                   │
│  7. User sees corporate desktop                        │
│                                                         │
│  ⚠️ UCPD REMAINS DISABLED (allows enforcement)        │
└─────────────────────────────────────────────────────────┘

3. Prerequisites
System Requirements

Windows 10 Pro or Windows 11 Pro
PowerShell 5.1+ (pre-installed)
Administrator access (installation only)
Minimum 10 MB free disk space

Required Applications

Google Chrome (installed)
Microsoft Office 2013/2016/2019/2021/365
Microsoft Teams (optional)

Required Files Before Installation
deployment-folder/
├── Deploy.bat                 # Deployment script
├── DesktopConfig.ps1          # Main PowerShell script
├── wallpaper.jpg              # ⚠️ MUST ADD - Company wallpaper
├── lockscreen.jpg             # ⚠️ MUST ADD - Company lock screen
└── screensaver.jpg            # ⚠️ MUST ADD - Company screensaver
⚠️ CRITICAL: You MUST add the three image files (wallpaper.jpg, lockscreen.jpg, screensaver.jpg) to the deployment folder BEFORE running Deploy.bat.
Image Specifications:

Format: JPEG (recommended) or PNG
Wallpaper: 1920x1080 or higher (16:9 aspect ratio)
Lock Screen: 1920x1080 or higher
Screensaver: Any resolution (will be resized)
File Size: Under 5MB each for performance


4. Installation Steps
Step 1: Prepare Deployment Package

Create deployment folder (e.g., C:\Temp\DesktopDeploy\)
Copy these files to the folder:

Deploy.bat
DesktopConfig.ps1


⚠️ ADD YOUR IMAGE FILES:

wallpaper.jpg - Your company wallpaper
lockscreen.jpg - Your company lock screen image
screensaver.jpg - Your company screensaver image


Verify all 5 files are present:

   Dir C:\Temp\DesktopDeploy\
   
   Should show:
   - Deploy.bat
   - DesktopConfig.ps1
   - wallpaper.jpg          ← Must exist
   - lockscreen.jpg         ← Must exist
   - screensaver.jpg        ← Must exist
Step 2: Customize Configuration (Optional)
Edit DesktopConfig.ps1 if you need to change:

Chrome homepage URL (default: https://www.google.com)
Screensaver timeout (default: 600 seconds = 10 minutes)
Office paths (if different version)

Step 3: Run Installation

Right-click Deploy.bat
Select "Run as administrator"
Deployment script will:

Create C:\Scripts\ and C:\Scripts\Images\
Copy PowerShell script to C:\Scripts\
Copy images to C:\Scripts\Images\
Disable UCPD service
Create scheduled task



Step 4: ⚠️ RESTART COMPUTER (Mandatory)
You MUST restart after installation.
Why restart is required:
- UCPD is a kernel-level driver
- Service changes require system restart
- Without restart, browser/email settings will fail
Step 5: Verify Installation
After restart:
powershell# Check scheduled task exists
Get-ScheduledTask -TaskName "DesktopConfiguration"

# Check script files exist
Test-Path "C:\Scripts\DesktopConfig.ps1"
Test-Path "C:\Scripts\Images\wallpaper.jpg"
Test-Path "C:\Scripts\Images\lockscreen.jpg"
Test-Path "C:\Scripts\Images\screensaver.jpg"

# Check UCPD is disabled
Get-Service UCPD
# Should show: Status=Stopped, StartType=Disabled
Step 6: Test Configuration

Log off current session
Log in as standard user (non-admin)
Wait 30 seconds
Verify settings applied:

Wallpaper changed
Lock screen updated (press Windows+L)
Chrome is default browser
Chrome opens to company homepage
Taskbar has corporate pins




5. Configuration Parameters
File: DesktopConfig.ps1 (Lines 46-70)
Image Paths (Fixed - Do Not Change)
ParameterValuePurposeWallpaperPathC:\Scripts\Images\wallpaper.jpgDesktop wallpaper (enforced every logon)LockScreenPathC:\Scripts\Images\lockscreen.jpgLock screen image (enforced every logon)ScreensaverPathC:\Scripts\Images\screensaver.jpgScreensaver image folder
⚠️ Do NOT change these paths - Deploy.bat copies images here automatically.
Customizable Settings
ParameterDefaultOptionsPurposeScreensaverTimeout600300=5min, 600=10min, 900=15minIdle time before screensaverScreensaverPasswordRequired$true$true, $falseRequire password after screensaverChromeHomepagehttps://www.google.comAny URLChrome startup page and homepage
Application Paths (Usually Don't Need Changes)
ParameterDefault PathPurposeChromePathC:\Program Files\Google\Chrome\Application\chrome.exeChrome browser locationOutlookPathC:\Program Files\Microsoft Office\root\Office16\OUTLOOK.EXEOutlook locationWordPathC:\Program Files\Microsoft Office\root\Office16\WINWORD.EXEWord for taskbar pinExcelPathC:\Program Files\Microsoft Office\root\Office16\EXCEL.EXEExcel for taskbar pinTeamsPath%LOCALAPPDATA%\Microsoft\WindowsApps\ms-teams.exeTeams for taskbar pin
Note: For Office 2013, change Office16 to Office15 in all Office paths.

6. Post-Installation
What Happens After Installation
Immediate (After Restart):

UCPD disabled (allows configuration)
Scheduled task ready
Images stored locally
System ready for enforcement

At Every User Logon:

Script runs automatically (hidden)
Settings applied/enforced within 30 seconds
User changes reverted automatically
Desktop appears with corporate standards

Enforcement Behavior
User ActionSystem ResponseUser changes wallpaperReset at next logonUser changes Chrome defaultReset at next logonUser changes homepageReset at next logonUser removes taskbar pinsRestored at next logonUser changes screensaverReset at next logon
Settings are enforced EVERY logon - no marker file prevents re-execution.
Manual UCPD Re-enable (Optional)
If your security policy requires UCPD enabled after initial configuration:
powershell# Run as Administrator
Set-Service -Name UCPD -StartupType Automatic
Enable-ScheduledTask -TaskName "\Microsoft\Windows\AppxDeploymentClient\UCPD velocity"

# Restart required
Restart-Computer
⚠️ WARNING: Re-enabling UCPD will break enforcement at next logon. Browser/email defaults will no longer be enforced. Only re-enable if you want one-time configuration instead of continuous enforcement.

8. Registry Changes Documentation
Registry Keys Modified
1. Lock Screen (System-Wide)
PathValueTypePurposeHKLM:\SOFTWARE\...\PersonalizationCSPLockScreenImagePathStringSets lock screen image path
2. Screensaver (Per-User)
PathValueTypeNew ValueHKCU:\Control Panel\DesktopScreenSaveActiveString1HKCU:\Control Panel\DesktopScreenSaveTimeOutString600HKCU:\Control Panel\DesktopSCRNSAVE.EXEStringPhotoScreensaver.scrHKCU:\Control Panel\DesktopScreenSaverIsSecureString1HKCU:\...\Photo Viewer\...\ScreensaverEncryptedPIDLStringBase64 image path
3. Chrome Default Browser (Per-User, All Profiles)
PathValueTypePurposeHKU\<SID>\...\UrlAssociations\http\UserChoiceHashStringWindows validation hashHKU\<SID>\...\UrlAssociations\http\UserChoiceProgIdStringChromeHTMLHKU\<SID>\...\UrlAssociations\https\UserChoiceHashStringWindows validation hashHKU\<SID>\...\UrlAssociations\https\UserChoiceProgIdStringChromeHTML
4. Chrome File Associations (.htm, .html, .pdf)
PathValueTypePurposeHKU\<SID>\...\FileExts\.htm\UserChoiceHashStringWindows validation hashHKU\<SID>\...\FileExts\.htm\UserChoiceProgIdStringChromeHTMLHKU\<SID>\...\FileExts\.html\UserChoiceHashStringWindows validation hashHKU\<SID>\...\FileExts\.html\UserChoiceProgIdStringChromeHTMLHKU\<SID>\...\FileExts\.pdf\UserChoiceHashStringWindows validation hashHKU\<SID>\...\FileExts\.pdf\UserChoiceProgIdStringChromeHTML
5. Chrome Homepage (Per-User, JSON File)
Location: C:\Users\[username]\AppData\Local\Google\Chrome\User Data\[Profile]\Preferences
Modified JSON properties:

homepage = Your company URL
homepage_is_newtabpage = false
browser.show_home_button = true
session.restore_on_startup = 4
session.startup_urls = [Your company URL]

6. Outlook Default Email (Per-User)
PathValueTypePurposeHKU\<SID>\...\UrlAssociations\mailto\UserChoiceHashStringWindows validation hashHKU\<SID>\...\UrlAssociations\mailto\UserChoiceProgIdStringOutlook.URL.mailto.15
7. UCPD Service (Installation Only)
PathValueTypeOldNewPurposeHKLM:\SYSTEM\...\Services\UCPDStartDWord24Disables UCPD permanently

9. Logs and Troubleshooting
Log File Locations
Main Log:
C:\Users\[username]\AppData\Local\Temp\DesktopConfig.log
Registry Changes CSV:
C:\Users\[username]\AppData\Local\Temp\DesktopConfig_RegistryChanges_YYYYMMDD_HHMMSS.csv
CSV Columns
ColumnDescriptionTimestampWhen change occurredActionPATH_CREATED, CREATED, MODIFIEDRegistryPathFull registry pathValueNameRegistry value nameOldValuePrevious value (for MODIFIED)NewValueNew value setValueTypeString, DWord, etc.
Common Issues
Issue 1: Images Not Found
Symptoms: Log shows "Wallpaper file not found"
Cause: Images not copied to C:\Scripts\Images\
Solution:
powershell# Check if images exist
Test-Path "C:\Scripts\Images\wallpaper.jpg"
Test-Path "C:\Scripts\Images\lockscreen.jpg"
Test-Path "C:\Scripts\Images\screensaver.jpg"

# If missing, copy manually:
Copy-Item "C:\Source\wallpaper.jpg" -Destination "C:\Scripts\Images\"
Copy-Item "C:\Source\lockscreen.jpg" -Destination "C:\Scripts\Images\"
Copy-Item "C:\Source\screensaver.jpg" -Destination "C:\Scripts\Images\"
Issue 2: Chrome Homepage Not Setting
Symptoms: Chrome opens to different page
Cause: Chrome was running when script executed
Solution: Log off and back on (Chrome must be closed for Preferences file modification)
Issue 3: Settings Not Enforced
Symptoms: User changes persist
Cause: Scheduled task not running
Solution:
powershell# Check task status
Get-ScheduledTask -TaskName "DesktopConfiguration"

# Check task history
Get-ScheduledTask -TaskName "DesktopConfiguration" | Get-ScheduledTaskInfo

# Run manually for testing
C:\Scripts\DesktopConfig.ps1 -Configure
Manual Testing
powershell# View main log
notepad C:\Users\$env:USERNAME\AppData\Local\Temp\DesktopConfig.log

# View registry changes
$csv = Get-ChildItem "$env:TEMP\DesktopConfig_RegistryChanges_*.csv" | 
       Sort-Object LastWriteTime -Descending | 
       Select-Object -First 1
& $csv.FullName

# Test configuration manually
C:\Scripts\DesktopConfig.ps1 -Configure

10. Rollback/Uninstall Steps
Complete Removal
Step 1: Remove Scheduled Task
powershell# Open PowerShell as Administrator
Unregister-ScheduledTask -TaskName "DesktopConfiguration" -Confirm:$false
Step 2: Re-enable UCPD (Optional)
powershellSet-Service -Name UCPD -StartupType Automatic
Enable-ScheduledTask -TaskName "\Microsoft\Windows\AppxDeploymentClient\UCPD velocity"

# Restart required
Restart-Computer
Step 3: Remove Script Files
powershellRemove-Item -Path "C:\Scripts" -Recurse -Force
Step 4: Verify Removal
powershell# Check task removed
Get-ScheduledTask -TaskName "DesktopConfiguration" -ErrorAction SilentlyContinue
# Should return nothing

# Check UCPD status
Get-Service UCPD
# If re-enabled: Status=Running, StartType=Automatic

# Check files removed
Test-Path "C:\Scripts"
# Should return False
Reset User Settings (Optional)
powershell# Reset default browser manually
Start-Process ms-settings:defaultapps

# Reset wallpaper to Windows default
# (User can change via Settings > Personalization > Background)

Summary Checklist
Before Installation

 Prepare deployment folder
 Add Deploy.bat and DesktopConfig.ps1
 ⚠️ ADD wallpaper.jpg (1920x1080 JPEG recommended)
 ⚠️ ADD lockscreen.jpg (1920x1080 JPEG recommended)
 ⚠️ ADD screensaver.jpg (Any resolution JPEG)
 Verify all 5 files present
 Customize Chrome homepage URL if needed (optional)
 Backup Windows Registry

During Installation

 Run Deploy.bat as Administrator
 Wait for completion
 ⚠️ RESTART COMPUTER

After Installation

 Verify scheduled task created
 Verify images copied to C:\Scripts\Images\
 Verify UCPD disabled
 Test with standard user account
 Check logs for errors
 Verify settings enforced

Ongoing

 Settings enforced every logon automatically
 Review logs periodically
 Monitor for issues
 Keep image files in C:\Scripts\Images\


Note: UCPD remains disabled permanently to allow enforcement at every logon. This is intentional and required for the enforcement feature to work. Re-enabling UCPD will break the enforcement functionality.
End of Documentation